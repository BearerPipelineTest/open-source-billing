$('body').append("<%= escape_javascript render partial: 'new_form_popup', locals: {user: @sub_user}  %>");
SubUser.load_functions();
elem = $("#new_form_popup");
Popup.initialize(elem);
Popup.open(elem);

$('#new_user_role_id').material_select('destroy');
$('#new_user_role_id').select2({
    placeholder: 'Role'
})

$(".edit-user-select2").prepend("<span class='select-2-asterik'>*</span>");

$('.companies-list > label > input').addClass( "filled-in select_company_checkbox" );
$('.companies-list > label > input').attr('name', 'company_ids[]');
$('#user_have_all_companies_access_true').attr('name', 'have_all_companies_access');
$('#user_have_all_companies_access_false').attr('name', 'have_all_companies_access');

if($('#user_have_all_companies_access_true').is(':checked')){
    $('.company-selection').hide();
}
else if ($('#user_have_all_companies_access_false').is(':checked')){
    $('.company-selection').show();
}
$('#user_have_all_companies_access_true').click(function () {
    $('.company-selection').hide();
})
$('#user_have_all_companies_access_false').click(function () {
    $('.company-selection').show();
})
Validation.UserSettingForm();